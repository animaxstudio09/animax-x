<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ANIMAX X - ULTIMATE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --gold: #FFD700; --card-bg: #0a0a0a; --border: 1px solid #1a1a1a; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Outfit', sans-serif; background: #000; color: #fff; overflow-x: hidden; }

        /* Auth Screen */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: #0a0a0a; padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; border: var(--border); }
        
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: #000; position: sticky; top: 0; z-index: 1000; border-bottom: var(--border); }
        .logo { font-family: 'Orbitron'; font-weight: 900; font-size: 18px; letter-spacing: 1px; }
        .logo span { color: var(--gold); }

        /* Banner & Folders */
        #banner-slider { width: 92%; height: 170px; margin: 15px auto; border-radius: 15px; overflow: hidden; position: relative; border: var(--border); }
        .slide { position: absolute; inset: 0; opacity: 0; transition: 1s; background-size: cover; background-position: center; }
        .slide.active { opacity: 1; }
        #folder-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 15px 20px; }
        .folder-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; border: var(--border); aspect-ratio: 2/3; position: relative; }
        .folder-card img { width: 100%; height: 100%; object-fit: cover; }
        .folder-overlay { position: absolute; bottom: 0; width: 100%; padding: 20px 5px 8px; background: linear-gradient(transparent, #000); text-align: center; font-size: 10px; font-weight: bold; }

        /* Player & Premium Ad Logic (Screenshot 2 Match) */
        #player-view { display: none; position: fixed; inset: 0; background: #000; z-index: 5000; overflow-y: auto; }
        .video-box { width: 100%; aspect-ratio: 16/9; position: sticky; top: 0; background: #000; z-index: 5001; }
        video { width: 100%; height: 100%; }
        #ad-lock-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.96); z-index: 6000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        .lock-icon { width: 60px; height: 60px; background: var(--gold); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; box-shadow: 0 0 20px rgba(255,215,0,0.3); }
        .lock-icon i { color: #000; font-size: 28px; }
        .btn-watch { width: 240px; padding: 16px; background: var(--gold); border: none; border-radius: 12px; font-family: 'Orbitron'; font-weight: 800; font-size: 14px; cursor: pointer; color: #000; text-transform: uppercase; }

        /* Profile (Screenshot 1 Match) */
        #profile-view { display: none; padding: 20px; text-align: center; padding-bottom: 100px; }
        .avatar-wrap { width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--gold); margin: 0 auto 15px; overflow: hidden; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 25px 0; background: #0d0d0d; padding: 18px; border-radius: 18px; border: var(--border); }
        .stat-box { text-align: center; }
        .stat-v { font-family: 'Orbitron'; color: #fff; font-size: 16px; display: block; }
        .stat-l { font-size: 9px; color: #555; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* Buttons & Nav */
        input { width: 100%; padding: 16px; background: #050505; border: var(--border); border-radius: 12px; color: #fff; margin-bottom: 15px; text-align: center; }
        .btn-blue { width: 100%; padding: 16px; background: #0088cc; border: none; border-radius: 12px; font-weight: 800; color: #fff; margin-bottom: 10px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 12px; }
        .btn-logout { width: 100%; padding: 16px; background: #1a1a1a; color: #555; border: none; border-radius: 12px; font-family: 'Orbitron'; font-size: 13px; }

        nav { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.98); display: flex; justify-content: space-around; padding: 18px; border-top: var(--border); z-index: 4000; }
        nav i { font-size: 20px; color: #333; }
        nav i.active { color: var(--gold); }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card" id="login-form">
            <h2 style="font-family:'Orbitron'; color:var(--gold); margin-bottom:20px;">ANIMAX X</h2>
            <input type="email" id="email-in" placeholder="Email Address">
            <input type="password" id="pass-in" placeholder="Password">
            <button class="btn-watch" style="width:100%;" onclick="handleAuth('login')">LOGIN</button>
            <p style="font-size:10px; color:#444; margin-top:15px;" onclick="toggleAuth()">Create New Account</p>
        </div>
        <div class="auth-card" id="reg-form" style="display:none;">
            <h2 style="font-family:'Orbitron'; margin-bottom:20px;">REGISTER</h2>
            <input type="email" id="remail-in" placeholder="Email Address">
            <input type="password" id="rpass-in" placeholder="Password">
            <button class="btn-watch" style="width:100%;" onclick="handleAuth('reg')">REGISTER</button>
            <p style="font-size:10px; color:#444; margin-top:15px;" onclick="toggleAuth()">Already have account? Login</p>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <div id="home-view">
            <header>
                <div class="logo">ANIMAX <span>X</span></div>
                <i class="fas fa-search" style="color:#222;"></i>
            </header>
            <div id="banner-slider"></div>
            <p style="padding:10px 20px; font-size:11px; font-family:'Orbitron'; color:var(--gold);">EXPLORE SERIES</p>
            <div id="folder-grid"></div>
        </div>

        <div id="ep-list-view" style="display:none; position:fixed; inset:0; background:#000; z-index:3000; overflow-y:auto; padding-bottom:80px;">
            <div id="ser-banner" style="width:100%; height:220px; background-size:cover; background-position:center; position:relative;">
                <i class="fas fa-arrow-left" onclick="closeEpList()" style="position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.5); padding:10px; border-radius:50%;"></i>
            </div>
            <div style="padding:15px;">
                <h2 id="ser-title" style="font-family:'Orbitron'; color:var(--gold); font-size:16px;">SERIES</h2>
                <div id="episodes-container" style="margin-top:20px;"></div>
            </div>
        </div>

        <div id="player-view">
            <div class="video-box">
                <i class="fas fa-times" onclick="closePlayer()" style="position:absolute; top:15px; right:15px; z-index:10; background:rgba(0,0,0,0.5); padding:10px; border-radius:50%;"></i>
                <video id="main-video" controls playsinline></video>
                <div id="ad-lock-overlay">
                    <div class="lock-icon"><i class="fas fa-lock"></i></div>
                    <h3 style="font-family:'Orbitron'; font-size:15px; letter-spacing:1px;">PREMIUM CONTENT</h3>
                    <p style="font-size:10px; color:#555; margin:10px 0 25px;">Watch a short video to unlock or buy VIP</p>
                    <button class="btn-watch" onclick="simulateAd()">WATCH AD TO PLAY</button>
                    <p style="font-size:10px; color:var(--gold); margin-top:20px;" onclick="showTab('profile')">UPGRADE TO VIP (NO ADS)</p>
                </div>
            </div>
            <div style="padding:20px;">
                <h3 id="play-title" style="font-family:'Outfit'; color:var(--gold); font-size:14px; margin-bottom:15px;">TITLE</h3>
                
                <div style="background:#0d0d0d; border:1px solid #111; padding:15px; border-radius:12px; text-align:center; margin-bottom:20px;">
                    <p style="font-size:8px; color:#222; margin-bottom:5px;">ADVERTISEMENT</p>
                    <script type="text/javascript"> atOptions = { 'key' : '9f634c6894bc13ff8f0f19de1fcac9f3', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} }; </script>
                    <script src="https://www.highperformanceformat.com/9f634c6894bc13ff8f0f19de1fcac9f3/invoke.js"></script>
                </div>

                <p style="font-size:10px; color:#333; font-family:'Orbitron'; margin-bottom:12px;">UP NEXT</p>
                <div id="next-episodes"></div>
            </div>
        </div>

        <div id="profile-view">
            <div class="avatar-wrap"><img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" style="width:100%;"></div>
            <h2 id="u-id" style="font-family:'Orbitron'; letter-spacing:1px;">USER</h2>
            <div id="u-badge" style="background:#111; display:inline-block; padding:5px 15px; border-radius:20px; font-size:9px; color:#555; margin-top:8px;">FREE MEMBER</div>

            <div class="stats-grid">
                <div class="stat-box"><span class="stat-v">0</span><span class="stat-l">Watched</span></div>
                <div class="stat-box"><span class="stat-v" id="u-plan">Free</span><span class="stat-l">Plan</span></div>
                <div class="stat-box"><span class="stat-v">Active</span><span class="stat-l">Status</span></div>
            </div>

            <div style="background:#0a0a0a; padding:20px; border-radius:15px; border:var(--border); margin-bottom:20px;">
                <p style="font-size:10px; color:var(--gold); margin-bottom:15px; font-family:'Orbitron';">ACTIVATE VIP MEMBERSHIP</p>
                <input type="text" id="license-key" placeholder="Enter License Key">
                <button class="btn-watch" style="width:100%;" onclick="redeemVip()">UPGRADE NOW</button>
            </div>

            <a href="https://t.me/aminezone09" target="_blank" class="btn-blue"><i class="fab fa-telegram-plane"></i> BUY PREMIUM KEY</a>
            <button class="btn-logout" onclick="firebase.auth().signOut()">LOGOUT</button>
        </div>

        <nav>
            <i class="fas fa-home active" id="n-home" onclick="showTab('home')"></i>
            <i class="fas fa-play" style="opacity:0.2;"></i>
            <i class="fas fa-user-circle" id="n-profile" onclick="showTab('profile')"></i>
        </nav>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBcWE5TCxamMSnJxqSm5X4mgSwSccIXcBI", authDomain: "myanimeapp-8d079.firebaseapp.com", databaseURL: "https://myanimeapp-8d079-default-rtdb.firebaseio.com", projectId: "myanimeapp-8d079", storageBucket: "myanimeapp-8d079.firebasestorage.app", messagingSenderId: "37482342893", appId: "1:37482342893:web:bebc7352e4bc102b725fe4" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(), db = firebase.database();
        let groupedAnime = {}, isVip = false;

        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('auth-screen').style.display='none';
                document.getElementById('main-app').style.display='block';
                document.getElementById('u-id').innerText = user.email.split('@')[0].toUpperCase();
                checkVipExpiry(user.uid); loadBanners(); loadFolders();
            } else {
                document.getElementById('auth-screen').style.display='flex';
                document.getElementById('main-app').style.display='none';
            }
        });

        // Fixed Income Ad Logic
        function simulateAd() {
            const b = document.querySelector('.btn-watch');
            b.innerText = "LOADING SECURE AD...";
            
            // আপনার ডাইরেক্ট লিঙ্কটি এখানে একদম পারফেক্টলি সেট করা হয়েছে
            const adUrl = 'https://www.effectivegatecpm.com/e3t9unhgv?key=2723dc497461b7507ba151e88ee0e871'; 

            const adWindow = window.open(adUrl, '_blank');

            if (adWindow) {
                setTimeout(() => {
                    alert("Content Unlocked! Press OK to Play.");
                    document.getElementById('ad-lock-overlay').style.display = 'none';
                    document.getElementById('main-video').play();
                    b.innerText = "WATCH AD TO PLAY";
                }, 10000); // ১০ সেকেন্ড অপেক্ষা ইনকাম নিশ্চিত করতে
            } else {
                alert("Please allow pop-ups for this site to unlock video!");
                window.location.href = adUrl; // পপআপ ব্লক হলে রিডাইরেক্ট করে অ্যাড দেখানো
            }
        }

        function loadFolders() {
            db.ref('anime').on('value', s => {
                groupedAnime = {};
                const grid = document.getElementById('folder-grid'); grid.innerHTML = "";
                s.forEach(child => {
                    const d = child.val(); const f = d.folder || "Uncategorized";
                    if(!groupedAnime[f]) groupedAnime[f] = []; groupedAnime[f].push(d);
                });
                Object.keys(groupedAnime).forEach(name => {
                    grid.innerHTML += `<div class="folder-card" onclick="openFolder('${name.replace(/'/g,"\\'")}')">
                        <img src="${groupedAnime[name][0].thumbnail}"><div class="folder-overlay">${name}</div>
                    </div>`;
                });
            });
        }

        function openFolder(name) {
            document.getElementById('ser-banner').style.backgroundImage = `url('${groupedAnime[name][0].thumbnail}')`;
            document.getElementById('ser-title').innerText = name;
            const con = document.getElementById('episodes-container'); con.innerHTML = "";
            groupedAnime[name].forEach((ep, i) => {
                const isPrem = ep.type === 'premium';
                con.innerHTML += `
                <div style="background:#0d0d0d; border-radius:12px; padding:15px; border:var(--border); margin-bottom:10px; display:flex; align-items:center;" onclick="playVideo('${ep.title.replace(/'/g,"\\'")}', '${ep.url}', '${name.replace(/'/g,"\\'")}', ${isPrem})">
                    <div style="width:30px; color:var(--gold); font-family:'Orbitron'; font-size:12px;">${i+1}</div>
                    <div style="flex:1; font-size:12px;">${ep.title} ${isPrem ? '<i class="fas fa-crown" style="color:var(--gold); font-size:10px; margin-left:5px;"></i>' : ''}</div>
                    <i class="fas ${isPrem ? 'fa-lock' : 'fa-play-circle'}" style="color:${isPrem ? '#333' : 'var(--gold)'};"></i>
                </div>`;
            });
            document.getElementById('ep-list-view').style.display = 'block';
        }

        function playVideo(title, url, folder, prem) {
            document.getElementById('play-title').innerText = title;
            const v = document.getElementById('main-video');
            if(prem && !isVip) {
                document.getElementById('ad-lock-overlay').style.display = 'flex';
                v.pause();
            } else {
                document.getElementById('ad-lock-overlay').style.display = 'none';
                v.src = url; v.play();
            }
            document.getElementById('player-view').style.display = 'block';
            
            const next = document.getElementById('next-episodes'); next.innerHTML = "";
            let found = false;
            groupedAnime[folder].forEach(ep => {
                if(found) {
                    next.innerHTML += `<div style="background:#0d0d0d; padding:15px; border-radius:12px; border:var(--border); margin-bottom:10px; font-size:11px;" onclick="playVideo('${ep.title.replace(/'/g,"\\'")}', '${ep.url}', '${folder.replace(/'/g,"\\'")}', ${ep.type==='premium'})">${ep.title}</div>`;
                }
                if(ep.title === title) found = true;
            });
        }

        function checkVipExpiry(uid) {
            db.ref('users/'+uid).on('value', s => {
                const d = s.val();
                if(d && d.isPremium) {
                    const now = Date.now(), exp = d.premiumUntil || 0;
                    if(now > exp) { db.ref('users/'+uid).update({ isPremium: false }); updateUI(false); }
                    else updateUI(true);
                } else updateUI(false);
            });
        }

        function updateUI(v) {
            isVip = v;
            document.getElementById('u-badge').innerText = v ? "ROYAL MEMBER" : "FREE MEMBER";
            document.getElementById('u-badge').style.color = v ? "var(--gold)" : "#555";
            document.getElementById('u-plan').innerText = v ? "Premium" : "Free";
        }

        function redeemVip() {
            const key = document.getElementById('license-key').value.trim();
            db.ref('premium_codes/'+key).once('value', s => {
                if(s.exists() && s.val().status === 'unused') {
                    const d = s.val().days || 30;
                    const exp = Date.now() + (d * 24 * 60 * 60 * 1000);
                    db.ref('premium_codes/'+key).update({ status: 'used' });
                    db.ref('users/'+auth.currentUser.uid).update({ isPremium: true, premiumUntil: exp });
                    alert("VIP Activated Successfully!");
                } else alert("Invalid Key");
            });
        }

        function loadBanners() {
            db.ref('banners').on('value', s => {
                const c = document.getElementById('banner-slider'); c.innerHTML = "";
                let i = 0; s.forEach(b => {
                    c.innerHTML += `<div class="slide ${i===0?'active':''}" style="background-image:url('${b.val().image}')"></div>`;
                    i++;
                });
                setInterval(() => {
                    let active = c.querySelector('.slide.active');
                    if(active) { active.classList.remove('active'); (active.nextElementSibling || c.querySelector('.slide')).classList.add('active'); }
                }, 5000);
            });
        }

        function showTab(t) {
            document.getElementById('home-view').style.display = t==='home'?'block':'none';
            document.getElementById('profile-view').style.display = t==='profile'?'block':'none';
            document.getElementById('n-home').classList.toggle('active', t==='home');
            document.getElementById('n-profile').classList.toggle('active', t==='profile');
        }

        function handleAuth(t) {
            const e = t==='login'?document.getElementById('email-in').value:document.getElementById('remail-in').value;
            const p = t==='login'?document.getElementById('pass-in').value:document.getElementById('rpass-in').value;
            if(t==='login') auth.signInWithEmailAndPassword(e,p).catch(a=>alert(a.message));
            else auth.createUserWithEmailAndPassword(e,p).catch(a=>alert(a.message));
        }

        function toggleAuth() {
            const l = document.getElementById('login-form'), r = document.getElementById('reg-form');
            l.style.display = l.style.display==='none'?'block':'none'; r.style.display = r.style.display==='none'?'block':'none';
        }

        function closePlayer() { const v = document.getElementById('main-video'); v.pause(); v.src=""; document.getElementById('player-view').style.display = 'none'; }
        function closeEpList() { document.getElementById('ep-list-view').style.display = 'none'; }
    </script>
</body>
</html>
